---
title: "Results"
author: "Stephanie Bland"
date: '2017-10-27'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE,echo=FALSE)
```
```{r hidden}
#---- Hidden ----
library(ggbiplot)
library(tidyverse)
library(MASS)
library(stringr)
DATE="2017Jul19"
Version="0"
location="/GIT/Analysis"#For Running on my Mac
#location=""#For Clusters
run_name=paste0(DATE,"_",Version)
setwd(paste0("~/",location,"/",run_name))
#---- LOAD_DATA ----
backupdata=read.table("Melted.txt",header=F)
colnames(backupdata)=as.matrix(read.table("colnames.txt"))
alldata=backupdata
alldata=alldata[alldata$Prey==0,]
alldata=alldata[alldata$Pred==2,]
alldata=alldata[alldata$Phase_df==2,]

#---- LOAD_DATA ----
# The first step should be setting up better names, so the legends will automatically be named properly. This is to avoid having vague graphs with names like "experiment 1" and experiment 2" because people will definitely forget what that means.
node_names=levels(factor(alldata$Nodes_df))
# In the following line we have some difficulty with node names - after 10 the levels function tries to sort alphabetically but fails miserably.
node_names=cbind(node_names,c("Autotrophs",paste("Life stage",1:4),paste("Fish",1:3),"Fish","Invertebrates",rep("Node",39),"Non Fish","Total Biomass"))
exper_name=c("Leslie & History","Extended Web","Original Web")
```

## First Paragraph: Overall description, general overview

```{r Percent_Stable}
nodes="Fish_tot_df"
persist=alldata %>% group_by(Simnum, Exper, Nodes_df) %>%
	filter(Year_df %in% max(Year_df), Nodes_df %in% nodes) %>%
	spread(key=Exper, value=Biomass) %>%
	summarise(any=sum(`1`,`2`,`3`),all=prod(`1`,`2`,`3`)) %>%
	mutate_at(c("any","all"),as.logical)
# 1.
criteria1=100*sum(persist$any)/length(persist$any)
# 2.
criteria2=100*sum(persist$all)/length(persist$all)
```

A typical time series of the logged biomass for a stable population is shown in figure x. 

`r criteria1`% of our simulations met the criteria for the first part of the analysis, meaning fish stabilized in at least one of the experiments. `r criteria2`% of our simulations met the second criteria, where at least one fish must stabilize in every experiment. We anticipated that some simulations would never stablize, as we placed minimal constraints on food webs during the web creation stage. Some of the webs we created would invariably end up being completely biologically unrealistic. This process of weeding out unstable webs might seem unintuitive at first, but it mimics what we observe in nature. Just as natural landscapes are eventually populated by stable ecosystems after a long process of species invasions and extinctions. One would not expect to be able to take a random species from a different continent and populate an island and fill a niche that they were not adapted to. The few species that can successfully invade are anomalies. 
```{r Total Biomass Stability}
nodes="Tot_df"
persist=alldata %>% group_by(Simnum, Exper, Nodes_df) %>%
	filter(Year_df %in% max(Year_df), Nodes_df %in% nodes) %>%
	spread(key=Exper, value=Biomass) %>%
	summarise(any=sum(`1`,`2`,`3`),all=prod(`1`,`2`,`3`)) %>%
	mutate_at(c("any","all"),as.logical)
# Percent of webs that stabilize for any species in every experiment
criteria2_totBiomass=100*sum(persist$all)/length(persist$all)
```
`r criteria2_totBiomass`% of our simulations stabilized for any species in every experiment. This includes webs were fish would go extinct. 

## Second Paragraph: Number of extinctions
```{r extant_species}
count_extant=alldata %>% group_by(Simnum, Exper, Nodes_df) %>%
	filter(Year_df %in% max(Year_df), str_detect(Nodes_df,"Fish_sp_")) %>% 
	summarise(Extant=(Biomass>0)) %>%
	spread(key=Nodes_df, value=Extant) %>%
	summarise(fish_persist=sum(Fish_sp_1,Fish_sp_2,Fish_sp_3)) %>%
	spread(key=Exper,value=fish_persist) %>%
	mutate(keep_sim=sum(`1`,`2`,`3`)) %>%
	filter(keep_sim>0)
x=mean(count_extant$`1`)
y=mean(count_extant$`2`)
z=mean(count_extant$`3`)
sem <- function(x) {sd(x)/sqrt(length(x))}
meh=data.frame(Exper=1:3,Num_extant=c(x,y,z),se=c(sem(count_extant$`1`),sem(count_extant$`2`),sem(count_extant$`3`)))
ggplot(meh, aes(x=Exper, y=Num_extant)) +
	geom_bar(position=position_dodge(),stat="identity") + 
	geom_errorbar(aes(ymin=Num_extant-2*se, ymax=Num_extant+2*se), width=.1) +
	xlab("Experiment") + ylab("Number of extant fish") +
	labs(caption="The mean number of extant fish in each experiment. The error bars are of 2 times the standard error.")
```

Bar plot for 3 experiments and percent extinction error bar variance: First one is percent of extinctions among all species (not nodes i think), second is extinction among fish only
just make sure i talk about the cool stuff i emailed
Fish are more likely to go extinct 
The probability of any single life stage persisting is greater when they are linked together than without.


## Third Paragraph: Stability -> Coefficient variation (CV)
Start with stability of total ecosystem, finish with stability of fish only (one or two paragraphs)
Fish to total biomass ratios for each experiment


## End paragraph: Von-Bertalanffy
PROVE THAT FISH LIFE HISTORIES LOOK REALISTIC. I WANT TO CONVINCE THE READER THAT THESE ARE REAL FISH TOTALLY NOT MADE UP
coefficient of variation plot (indep) against weight_\infty (dependent) also biomass against weight_\infty (for both fish and total so four panel plot!)



```{r pressure, echo=FALSE}
plot(pressure)
```















